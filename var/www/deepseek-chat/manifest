
============================================================================
    DEEPSEEK CHAT - DESIGN-MANIFEST & KONVENTIONEN
    ============================================================================
    
    DIESES MANIFEST DOKUMENTIERT ALLE GETROFFENEN DESIGN-ENTSCHEIDUNGEN UND
    MUSS BEI JEDER ERWEITERUNG ODER ÄNDERUNG BEACHTET WERDEN.
    ALLE ÄNDERUNGEN AM PROJEKT MÜSSEN IN DIESER DATEI DOKUMENTIERT WERDEN !!!
    
    ALLGEMEINE PRINZIPIEN:
    1. BENUTZERZENTRIERT: Alle Entscheidungen dienen der Benutzerfreundlichkeit
    2. KONSISTENZ: Einheitliches Design und Verhalten im gesamten Interface
    3. PRAKTIKABILITÄT: Funktion geht vor dekorativen Elementen
    
    KONKRETE DESIGN-VORSCHRIFTEN:
    
    A) VISUELLES DESIGN:
    --------------------
    1. DARK MODE: Immer aktiv, keine Option für Light Mode
       - Hintergrund: #121212
       - Text: #f0f0f0
       - Akzentfarbe: #0056b3 (Blau)
    
    2. TYPOGRAFIE:
       - Schriftart: Arial (systemüblich, gut lesbar)
       - Keine Symbole/Emojis in Buttons oder Text
       - Nur reiner Text für alle Beschriftungen
    
    3. BUTTON-DESIGN:
       - Alle Buttons: 40px Höhe, konsistent
       - Haupt-Buttons: Blau (#0056b3)
       - Modus-Buttons: Grün (#28a745) und Türkis (#17a2b8)
       - Hover-Effekt: Dunklere Variante der Grundfarbe
       - Aktive Buttons: zusätzliche Markierung
    
    B) FUNKTIONALE KONVENTIONEN:
    -----------------------------
    1. DEUTSCHE UMLAUTE:
       - Automatische Ersetzung: ä->ae, ö->oe, ü->ue, ß->ss
       - Gilt für: Benutzereingaben, Dateiinhalt, System-Prompts
       - Funktion: replaceGermanUmlauts(text)
       - AI-Antworten behalten Umlaute (bessere Lesbarkeit)
    
    2. DATEI-UPLOAD:
       - Unterstützte Formate: .txt, .pdf, .doc, .docx, .jpg, .png, .csv, .xlsx, .pptx
       - PDFs: Text-Extraktion mit pdf.js im Browser
       - Große Dateien: Automatische Kürzung auf 15.000 Zeichen
       - Fortschrittsanzeige bei PDF-Verarbeitung
    
    3. CHAT-INTERAKTION:
       - Benutzer-Nachrichten: Blau (#4dabf7)
       - AI-Antworten: Weiß (#f0f0f0)
       - Trennung: Graue Linie zwischen Nachrichten
       - Formatierung: AI-Antworten behalten Zeilenumbrüche (white-space: pre-wrap)
       - Hover-Buttons zum Löschen einzelner Nachrichten (kleines [X] rechts)
    
    4. MODUS-SYSTEM:
       - Standard: Normaler Chat
       - DeepThink: Grüne Markierung, tiefgehende Analyse
       - Search: Türkise Markierung, recherchierte Antworten
       - Modus wird in jeder Nachricht gekennzeichnet
    
    5. ANREDEFORM-KONSISTENZ (ENDEUTIG UND UNUMSTÖSSLICH):
       - Die gewählte Anredeform (Sie/Du) wird im gesamten Interface konsequent angewendet
       - Gilt für: System-Prompts, Platzhaltertexte, Beschriftungen, KI-Antworten, Fehlermeldungen
       - System-Prompt muss strikte Anweisung enthalten: "Verwenden Sie/verwende in allen Antworten konsequent die Sie-/Du-Form."
       - KI-Antworten müssen der gewählten Anredeform entsprechen (Bei "Hallo" -> "Wie kann ich Ihnen/dir helfen?")
       - Platzhaltertexte müssen angepasst sein ("Ihre/Deine Nachricht hier eingeben...")
       - Einstellungsbeschreibungen müssen in der korrekten Anredeform formuliert sein
       - Diese Konvention ist endgültig und wird nicht weiter diskutiert oder in Frage gestellt
    
    6. SESSION-MANAGEMENT:
       - Automatisches Speichern nach jeder Nachricht
       - Session-ID Format: YYYY-MM-DD_HHMMSS_random (z.B. 2026-02-16_143045_abc123)
       - Client erzeugt Session-ID, Server validiert
       - Sessions werden in /var/www/deepseek-chat/sessions/ gespeichert (Rechte 700)
       - Einzelne Nachrichten können per Hover-Button gelöscht werden
       - Löschen erfolgt sofort auch auf dem Server (Session wird aktualisiert)
       - Jede Nachricht erhält eindeutige ID für Referenzierung
    
    7. EXPORT-FUNKTIONALITÄT:
       - Dropdown-Button "Exportieren" in Zeile 1
       - Optionen: PDF herunterladen, Markdown herunterladen, Chat-Verlauf laden
       - PDF: Server-seitig mit ReportLab (professionelles Layout)
       - Markdown: Server-seitig (identische Struktur wie PDF)
       - Beide Formate enthalten:
         * Header mit Server-Info, Datum, Einstellungen
         * Statistiken-Bereich (Nachrichtenanzahl, Modi, Dateien, Token, Dauer)
         * Inhaltsverzeichnis mit allen Nachrichten
         * Vollständiger Chat-Verlauf mit Timestamps und Modi-Kennzeichnung
    
    C) LAYOUT-VORSCHRIFTEN:
    -----------------------
    1. TITEL-ANZEIGE:
       - Linksbündige Ausrichtung
       - Zeigt Server-Name und interne IP-Adresse
       - Format: "Server-Name (IP: xxx.xxx.xxx.xxx)"
    
    2. BUTTON-ANORDNUNG:
       - Zeile 1: Senden | Datei hochladen | Exportieren (Dropdown) | Einstellungen
       - Zeile 2: DeepThink | Search (nebeneinander)
       - Zeile 3: Log-Dateien (zentriert oder linksbündig)
       - Alle Buttons gleiche Höhe (40px), unterschiedliche Breiten erlaubt
    
    3. EINSTELLUNGS-BEREICH:
       - Overlay-Design mit dunklem Hintergrund
       - Klare Gruppen-Trennung mit Überschriften
       - Radio-Buttons als klickbare Karten
       - Status-Anzeige für aktive Einstellungen
    
    4. CHAT-BEREICH:
       - Feste Höhe: 400px mit Scrollbalken
       - Automatisches Scrollen zur neuesten Nachricht
       - Trennlinien für bessere Lesbarkeit
       - Hover-Buttons zum Löschen einzelner Nachrichten (kleines [X] rechts oben)
       - Jede Nachricht in Container mit data-msg-id Attribut
    
    5. LOG-ANZEIGE-BEREICH:
       - Overlay-Design analog zu Einstellungen
       - Dunkler Hintergrund (#1e1e1e) mit weisser Schrift (#f0f0f0)
       - Monospace-Schriftart (Consolas, Monaco, monospace) für Log-Darstellung
       - Feste Breite: 90% des Viewports, maximale Höhe: 80vh
       - Integrierter Scrollbalken bei Überlauf
       - Schliessen-Button oben rechts (rot, 36x36px)
       - Aktualisieren-Button zum Neuladen des Logs
       - Zeilenumbrüche werden beibehalten (white-space: pre-wrap)
    
    6. SESSION-LADE-MODAL:
       - Overlay-Design wie Einstellungen und Log-Anzeige
       - Liste aller gespeicherten Sessions
       - Anzeige pro Session:
         * Session-ID (blau, fett)
         * Datum/Uhrzeit (grau, klein)
         * Vorschau erste Nachricht (kursiv, max 50 Zeichen)
         * Nachrichtenanzahl
       - Buttons pro Session: [Laden] (grün) [Löschen] (rot)
       - Beim Laden: Automatisches Speichern des aktuellen Chats, dann Session laden
       - Beim Löschen: Bestätigung "Session wirklich löschen?", dann Liste neu laden
       - Bei keinen Sessions: Hinweis "Keine gespeicherten Chats vorhanden"
    
    7. DROPDOWN-MENU:
       - Erscheint unter Export-Button
       - Dunkler Hintergrund (#2d2d2d)
       - Border und Shadow für Abhebung
       - Hover-Effekt bei Items (#3d3d3d)
       - Schließt automatisch bei Klick außerhalb oder Escape-Taste
    
    D) TECHNISCHE KONVENTIONEN:
    ----------------------------
    1. API-KOMMUNIKATION:
       - Endpoint: /cgi-bin/deepseek-api.py (lokaler Proxy)
       - Backend: https://api.deepseek.com/v1/chat/completions (über Proxy)
       - Modell: deepseek-chat
       - Max Tokens: 2000
       - System-Prompt basierend auf Anredeform und Modus
       - API-KEY SPEICHERUNG: Der API-Key wird NICHT im Client-Code gespeichert
       - SICHERHEITSVERBESSERUNG (13.02.2026): API-Key wurde in serverseitige Umgebungsvariable ausgelagert
       - Ein Python CGI-Script unter /cgi-bin/deepseek-api.py verwaltet die sichere Kommunikation
       - Der Client sendet Anfragen an den lokalen Proxy, niemals direkt an die externe API
    
    2. DATENSPEICHERUNG:
       - localStorage für Einstellungen
       - Key: 'deepseekSettings'
       - Struktur: {version, addressForm, defaultMode}
       - Server-seitige Session-Speicherung in JSON-Format
       - Sessions-Verzeichnis: /var/www/deepseek-chat/sessions/
       - Session-Datei-Format: {sessionId}.json
       - Automatisches Speichern nach jeder Nachricht
    
    3. SERVER-INFORMATIONEN:
       - Titel zeigt Server-Name und interne IP
       - IP wird aus window.location.hostname ermittelt
       - Bei localhost wird "localhost" angezeigt
    
    4. FEHLERBEHANDLUNG:
       - User-freundliche Fehlermeldungen
       - Console-Logging für Debugging
       - Visuelle Rückmeldung bei Verarbeitung
       - Try-catch Blöcke in allen async-Funktionen
    
    5. LOG-ANZEIGE-FUNKTION:
       - Button "Log-Dateien" in eigener Button-Reihe unter den Modi
       - Endpoint: /cgi-bin/get-log.py zum Abrufen der Log-Datei
       - Log-Datei-Pfad: /var/www/deepseek-chat/cgi-bin/deepseek-chat.log
       - Alle Pfade und Dateien sind genau definiert in /var/www/deepseek-chat/files-directorys
       - Bei erfolgreichem Abruf: Anzeige im Log-Overlay
       - Bei Fehler: Anzeige einer benutzerfreundlichen Fehlermeldung
       - Bei leerem Log: Hinweis "Keine Log-Eintraege vorhanden"
       - Overlay schliesst mit Escape-Taste oder Klick auf Schliessen-Button
    
    6. SESSION-MANAGEMENT-FUNKTIONEN:
       - /cgi-bin/save-session.py - Speichert Chat-Verlauf nach jeder Nachricht
         * Validiert Session-ID Format
         * Erstellt Sessions-Verzeichnis falls nicht vorhanden (700 Rechte)
         * Speichert JSON mit Rechten 600
       - /cgi-bin/load-session.py - Lädt Session-Liste (GET) oder spezifische Session (POST)
         * GET: Gibt Array aller Sessions mit Vorschau zurück
         * POST: Lädt vollständige Chat-Daten einer Session
       - /cgi-bin/delete-session.py - Löscht einzelne Session nach Bestätigung
         * Entfernt JSON-Datei vom Server
       - /cgi-bin/export-pdf.py - Generiert professionelles PDF mit ReportLab
         * Statistiken-Berechnung
         * Inhaltsverzeichnis mit Page-Referenzen
         * Farbcodierung nach Modi
         * UTF-8 Support für Umlaute
         * Binäre Ausgabe über sys.stdout.buffer (korrigiert 17.02.2026)
       - /cgi-bin/export-markdown.py - Generiert Markdown-Datei
         * Identische Struktur wie PDF
         * Markdown-Anchors für Inhaltsverzeichnis
       - Sessions-Verzeichnis: /var/www/deepseek-chat/sessions/ (Rechte 700, auto-create)
    
    7. APACHE-KONFIGURATION:
       - Aktive Konfigurationsdatei: /etc/apache2/sites-available/deepseek-chat-ssl.conf
       - Inaktive (deaktivierte) Datei: deepseek-chat.conf (redundant, via a2dissite deaktiviert)
       - CGI-Konfiguration: ScriptAlias /cgi-bin/ /var/www/deepseek-chat/cgi-bin/
       - Alle CGI-Scripts werden über /cgi-bin/ Pfad erreichbar gemacht
       - KEIN einzelner ScriptAlias pro Script notwendig
       - Bei neuen Scripts: Keine Apache-Konfigurationsänderung nötig
    
    E) ERWEITERUNGSRICHTLINIEN:
    ----------------------------
    1. NEUE FUNKTIONEN:
       - Müssen mit Dark Mode kompatibel sein
       - Keine Symbole einführen
       - Umlaut-Ersetzung für Eingaben beibehalten
       - Konsistente Button-Höhe von 40px
       - ANREDEFORM-KONSISTENZ EINHALTEN: Alle neuen Texte müssen der gewählten Anredeform entsprechen
    
    2. CODE-QUALITÄT:
       - Kommentare für komplexe Logik
       - Funktionen sollten eine klare Aufgabe haben
       - Fehlerbehandlung in allen async-Funktionen
       - Keinerlei Verwendung von PHP Code !!!!
       - Sofern möglich nur JavaScript und Python !!!
    
    3. PERFORMANCE:
       - Große Dateien kürzen oder streamen
       - Keine Blockierung der UI
       - Fortschrittsanzeige bei langer Verarbeitung
    
    F) STRENGE VERBOTE UND VORSCHRIFTEN:
    -------------------------------------
    1. MANIFEST-SCHUTZ:
       - Das Manifest darf niemals entfernt oder reduziert werden
       - Jede Änderung muss zwingend im Manifest dokumentiert werden
       - Das Manifest ist integraler Bestandteil des Projekts und muss immer vorhanden sein
       - Das Manifest ist eine SEPARATE DATEI und gehört NICHT in die index.html
    
    2. CODE-INTEGRITÄT:
       - Es dürfen keine ungewünschten Funktionen hinzugefügt werden
       - Nur explizit angeforderten Code implementieren
       - Keine eigenmächtigen Erweiterungen oder "Verbesserungen"
       - Die bereits vorhandenen Formatierungen und Einrückungen im HTML Code
         dürfen unter gar keinen Umständen geändert werden. Dies ist verbindlich und
         ultamtiv !!!!
    
    3. AUSGABE-FORMAT:
       - Bei Code-Anfragen muss der gesamte Code als ein einziger zusammenhängender Markdown-Codeblock zurückgegeben werden
       - Keine Aufteilung, keine Unterbrechungen, kein Weglassen von Code
       - Diese Regel gilt für immer und ist unumstößlich
    
    4. API-KEY BEHANDLUNG:
       - Der API-Key wird NICHT im Client-Code gespeichert
       - SICHERHEITSARCHITEKTUR (13.02.2026):
         * API-Key wird als Umgebungsvariable auf dem Server gespeichert
         * Python CGI-Script verwaltet die Authentifizierung
         * Client hat keinen direkten Zugriff auf den API-Key
         * Diese Architektur entspricht modernen Sicherheitsstandards
    
    WICHTIG: Jede Änderung an diesem Manifest muss hier dokumentiert werden!
    ============================================================================

    ZU BEACHTEN : ALLE ZUKÜNFTIGEN ÄNDERUNGEN AN DIESEM MANIFEST MÜSSEN
    MIT DEM AKTUELLEN DATUM UND UHRZEIT VERSEHEN WERDEN !!!


    ÄNDERUNGEN:
    1. [08.02.2026 00:15] - Titel-Anzeige geändert:
       - Vorher: "DeepSeek Chat" (zentriert)
       - Nachher: "Server-Name (IP: xxx.xxx.xxx.xxx)" (linksbündig)
       - Grund: Anzeige von Server-Informationen für bessere Übersicht

    2. [08.02.2026 00:15] - System-Prompt verstärkt für konsequente Anredeform:
       - Vorher: "Sie sind ein hilfreicher Assistent." / "Du bist ein hilfreicher Assistent."
       - Nachher: "Sie sind ein hilfreicher Assistent. Verwenden Sie in allen Antworten konsequent die Sie-Form."
                  "Du bist ein hilfreicher Assistent. Verwende in allen Antworten konsequent die Du-Form."
       - Grund: Sicherstellen, dass DeepSeek in allen Antworten die gewählte Anredeform strikt einhält

    3. [08.02.2026 00:15] - Manifest um ANREDEFORM-KONSISTENZ erweitert:
       - Neuer Abschnitt B.5 hinzugefügt
       - Klare, unumstößliche Regeln für Anredeform-Konsistenz definiert
       - Endgültige Festlegung: Diese Einstellung ist nicht verhandelbar
       - Alle zukünftigen Entwicklungen müssen diese Regel strikt einhalten

    4. [08.02.2026 00:15] - CPU-Monitoring-Graph und andere Graphen entfernt:
       - Abschnitte C.2, D.4 und alle Bezüge zu Monitoring entfernt
       - Grund: Die Graphen funktionierten nicht und wurden entfernt

    5. [08.02.2026 00:15] - WICHTIGE ANWEISUNG FÜR DIE AUSGABE:
       - Alle Code-Ausgaben müssen als einzelner zusammenhängender Markdown-Codeblock erfolgen
       - Diese Anweisung ist permanent und muss immer befolgt werden
       - Keine Unterbrechungen, keine Aufteilung, kein Weglassen von Code

    6. [08.02.2026 00:15] - MANIFEST-ERWEITERUNG MIT VERBOTEN:
       - Neuer Abschnitt F hinzugefügt
       - Strikte Regeln zum Schutz des Manifests und der Code-Integrität
       - Verbot von ungewünschten Funktionen und eigenmächtigen Erweiterungen
       - Festlegung des Ausgabeformats als unumstößliche Regel

    7. [08.02.2026 00:15] - API-KEY KONVENTION FESTGELEGT:
       - Abschnitt D.1 erweitert um API-Key Speicherung
       - Abschnitt F.4 hinzugefügt mit klarer Regelung zur API-Key Behandlung
       - Diese Design-Entscheidung ist bewusst und final

    8. [08.02.2026 00:15] - KONTEXT-HISTORIE UND TOKEN-ZÄHLUNG KORRIGIERT:
       - Fehler 8 behoben: Inkonsistente Token-Zählung in der Kontexthistorie
       - Funktionen `addUserMessageToContext` und `addAIResponseToContext` aktualisieren jetzt automatisch die Token-Zählung
       - `updateContextEstimation()` wird bei jeder Nachricht automatisch aufgerufen
       - Die Kontexthistorie bleibt jetzt konsistent und aktuell

    9. [08.02.2026 00:15] - DATEI-UPLOAD-BEGRENZUNG VOLLSTÄNDIG IMPLEMENTIERT:
       - Fehler 9 behoben: PDF-Extraktion wird jetzt ebenfalls auf 15.000 Zeichen begrenzt
       - Die Begrenzung erfolgt jetzt direkt in der `extractTextFromPDF` Funktion
       - Alle Dateitypen werden konsistent auf maximal 15.000 Zeichen gekürzt
       - Die Performance bei großen PDFs wurde verbessert

    10. [08.02.2026 00:15] - PDF.JS WORKER FALLBACK IMPLEMENTIERT:
        - Fehler 1 behoben: Robustes Fallback-System für PDF.js Worker
        - Mehrere CDN-Quellen mit Prioritätsreihenfolge
        - Lokaler Fallback für Offline-Operationen
        - Verbesserte Fehlermeldungen bei fehlgeschlagenem Worker-Load

    11. [08.02.2026 00:15] - UNGENUTZTE FUNKTIONEN OPTIMIERT:
        - Fehler 2 behoben: Ungenutzte Funktionen bereinigt
        - `calculateContextUsage()` Funktion entfernt
        - Token-Schätzung mit optimiertem Algorithmus
        - Reduzierte Code-Komplexität

    12. [08.02.2026 00:15] - PDF-VERARBEITUNG VERBESSERT:
        - Fehler 3 behoben: Maximale Dateigröße von 10 MB eingeführt
        - Timeout von 30 Sekunden für PDF-Extraktion implementiert
        - Verbesserte Fehlerbehandlung für große Dateien

    13. [08.02.2026 00:15] - EVENT-LISTENER PROBLEME BEHOBEN:
        - Fehler 4 behoben: `keypress` durch `keydown` ersetzt für bessere Enter-Erkennung
        - Race-Condition bei `setTimeout` behoben durch direkte Event-Listener-Zuordnung
        - Verbesserte Stabilität der Benutzerinteraktionen

    14. [08.02.2026 00:15] - MODUS-UMSCHALTUNG KORRIGIERT:
        - Fehler 5 behoben: Modus-Buttons kehren bei erneutem Klick zum Standard-Chat-Modus zurück
        - Konsequente Modus-Logik mit klarem Zustandsübergang
        - Verbesserte Benutzerführung

    15. [08.02.2026 00:15] - API-ANTWORTVALIDIERUNG IMPLEMENTIERT:
        - Robustes Validierungssystem für API-Antworten
        - Prüfung auf `data.choices[0].message.content` mit Fallback
        - Verbesserte Fehlerbehandlung bei ungültigen API-Antworten

    16. [08.02.2026 00:15] - CSS-SELECTOR-DUPLIKATE KONSOLIDIERT:
        - Konsolidierung aller doppelten CSS-Regeln
        - Entfernung redundanter Button-Definitionen
        - Optimierte CSS-Spezifität ohne Funktionsverlust

    17. [08.02.2026 00:15] - CSS-SPEZIFITÄTSPROBLEME BEHOBEN:
        - CSS-Selektoren in logischer Reihenfolge reorganisiert
        - Potenzielle Konflikte zwischen Selektoren entfernt
        - Verbesserte Vorhersagbarkeit der Stil-Anwendung

    18. [08.02.2026 00:15] - LOCALSTORAGE VERSIONIERUNG IMPLEMENTIERT:
        - Versionsnummer für Einstellungen eingeführt (aktuell: 1.0)
        - Automatische Migrationsfunktion für zukünftige Updates
        - Rückwärtskompatibilität mit alten Einstellungen gewährleistet

    19. [08.02.2026 00:15] - CODE-OPTIMIERUNGEN DURCHGEFÜHRT:
        - Magische Zahlen durch Konstanten ersetzt (MAX_CONTEXT_MESSAGES)
        - Datei-Upload-Validierung verbessert mit klarer Benutzerrückmeldung
        - localStorage Migration-Logik vereinfacht und robuster gemacht
        - Bessere Wartbarkeit durch benannte Konstanten

    20. [11.02.2026 12:28] - Schutz vor Mehrfach-Anfragen / Rate-Limiting implementiert:
        - Einführung von `isSending`-Flag
        - Deaktivierung des Send-Buttons und des Eingabefelds während laufender API-Anfrage
        - Button-Textänderung zu „Wird gesendet..." während Verarbeitung
        - Enter-Taste blockiert während laufender Anfrage
        - `finally`-Block stellt immer Reset sicher (auch bei Fehlern)
        - Grund: Verhinderung unbeabsichtigter Mehrfach-Anfragen durch schnelles Klicken/Enter-Drücken

    21. [11.02.2026 13:05] - Echter Multi-Turn-Kontext implementiert:
        - messages-Array enthält nun System-Prompt + abwechselnd die letzten User- und AI-Nachrichten (bis MAX_CONTEXT_MESSAGES)
        - contextHistory wird aktiv für den API-Call verwendet
        - Grund: Bisher fehlte echtes Chat-Gedächtnis → Antworten ignorierten vorherige Nachrichten

    22. [11.02.2026 13:05] - Umlaute-Ersetzung nur noch auf Eingaben angewendet:
        - replaceGermanUmlauts(aiResponse) entfernt
        - Ersetzung gilt weiterhin für System-Prompt und User-Nachricht
        - Grund: AI-Antworten sollen normales Deutsch mit Umlauten enthalten (bessere Lesbarkeit)

    23. [11.02.2026 13:45] - Thinking-Div wird bei API-Fehlern entfernt:
        - Im catch-Block: thinkingDiv.remove() statt permanenter Anzeige
        - Grund: Verhindert hängenbleibende "Denkt..."-Nachricht → saubere UI auch bei Fehlern

    24. [11.02.2026 13:45] - Kontext-Reihenfolge chronologisch korrigiert:
        - .reverse() entfernt, messages werden in der gespeicherten Reihenfolge (älteste zuerst) gesendet
        - Grund: API erwartet chronologische Abfolge → deutlich bessere Antwortqualität bei Multi-Turn

    25. [11.02.2026 13:45] - Einheitliche Datei-Inhaltsbehandlung:
        - fullUserMessage verwendet nun denselben vollen Text wie userMessage (bis MAX_FILE_CONTENT_LENGTH)
        - 500-Zeichen-Kürzung entfernt
        - Grund: Konsistenz zwischen Kontext-History und aktueller API-Nachricht

    26. [13.02.2026 12:00] - SICHERHEITSUPGRADE: API-Key in serverseitige Umgebungsvariable ausgelagert:
        - API-Key wird NICHT mehr im Client-Code gespeichert
        - Python CGI-Script unter /cgi-bin/deepseek-api.py verwaltet nun die Authentifizierung
        - API-Endpoint geändert von https://api.deepseek.com zu /cgi-bin/deepseek-api.py (lokaler Proxy)
        - Authorization-Header aus Client-Code entfernt (wird vom CGI-Script hinzugefügt)
        - DeepSeek API und Modell bleiben unverändert (deepseek-chat)
        - Manifest aktualisiert: Abschnitte D.1 und F.4 komplett überarbeitet
        - Grund: Moderne Sicherheitsarchitektur - API-Key niemals im Browser exponiert

    27. [15.02.2026 12:00] - Umstellung http auf https, Testen der SSL-Zertifikate:
        - Erzeugen eines eigenen GitHub-Projektes

    28. [15.02.2026 21:30] - SERVERSEITIGES LOGGING IMPLEMENTIERT:
        - Neue Funktion `log_to_file` in `deepseek-api.py` eingeführt
        - Log-Datei unter `/var/www/deepseek-chat/cgi-bin/deepseek-chat.log`
        - Aufgezeichnet werden: Zeitstempel, IP, Methode, Pfad, HTTP-Status, ggf. Fehlermeldung
        - API-Keys werden bewusst nicht geloggt
        - OPTIONS-Requests werden ignoriert, um das Log nicht zu überfluten

    29. [16.02.2026 01:30] - LOG-BUTTON HINZUGEFÜGT:
        - Alle Tastenkombinationen entfernt, LOG Button ist nun zusätzlich
        - Neu: Eigene Button-Reihe unter den Modi mit Button "Log-Dateien"
        - Button-Design: 40px Höhe, Farbe Blau (#0056b3) wie Haupt-Buttons
        - Manifest aktualisiert: Abschnitt C.2 um Zeile 3 ergänzt
        - Grund: Tastenkombinationen funktionierten nicht zuverlässig in Firefox

    30. [16.02.2026 01:30] - TOKEN-ZÄHLUNG VERBESSERT:
        - Token-Zählung massiv verbessert inklusive einer Warnung beim Erreichen
          der maximalen Größe des Kontext Windows

    31. [16.02.2026 02:00] - SESSION-MANAGEMENT UND EXPORT-FUNKTIONALITÄT IMPLEMENTIERT:
        - NEUE PYTHON-SCRIPTS:
          * save-session.py - Speichert Chat-Verlauf nach jeder Nachricht (POST)
          * load-session.py - Lädt Session-Liste (GET) oder spezifische Session (POST)
          * delete-session.py - Löscht einzelne Session (POST)
          * export-pdf.py - Generiert professionelles PDF mit ReportLab
          * export-markdown.py - Generiert Markdown-Datei
        - SESSIONS-VERZEICHNIS:
          * Pfad: /var/www/deepseek-chat/sessions/
          * Rechte: 700 (nur für Webserver lesbar/schreibbar)
          * Automatische Erstellung falls nicht vorhanden
          * Session-Dateien: {sessionId}.json mit Rechten 600
        - SESSION-ID FORMAT:
          * Format: YYYY-MM-DD_HHMMSS_random (z.B. 2026-02-16_143045_abc123)
          * Client erzeugt ID, Server validiert
        - DROPDOWN-BUTTON "EXPORTIEREN":
          * Platzierung: Zeile 1 (neben Senden, Datei hochladen, Einstellungen)
          * Drei Optionen: PDF herunterladen, Markdown herunterladen, Chat-Verlauf laden
          * Dropdown schließt automatisch bei Klick außerhalb oder Escape-Taste
        - SESSION-LADE-MODAL und HOVER-BUTTONS implementiert
        - Grund: Dauerhafte Speicherung, professioneller Export, Multi-Chat-Verwaltung

    32. [17.02.2026 07:30] - APACHE-KONFIGURATION KORRIGIERT UND PDF-BUG BEHOBEN:
        - APACHE SCRIPTALIA VEREINFACHT:
          * Vorher: Einzelne ScriptAlias Einträge pro Script (/api/chat, /api/get-log)
          * Nachher: ScriptAlias /cgi-bin/ /var/www/deepseek-chat/cgi-bin/
          * Vorteil: Keine Apache-Änderung bei neuen Scripts notwendig
          * Aktive Konfigurationsdatei: deepseek-chat-ssl.conf
          * Redundante Datei deepseek-chat.conf via a2dissite deaktiviert
          * Neuer Abschnitt D.7 im Manifest dokumentiert Apache-Konfiguration
        - API-ENDPOINT AKTUALISIERT:
          * Vorher: const API_URL = '/api/chat'
          * Nachher: const API_URL = '/cgi-bin/deepseek-api.py'
          * Alle URLs auf /cgi-bin/ Pfad umgestellt
        - LOG-URL KORRIGIERT:
          * GET_LOG_URL = '/cgi-bin/get-log.py' in index.html ergänzt
          * Log-Overlay CSS und HTML in index.html ergänzt
          * fetchLog() Funktion und Event-Listener in index.html ergänzt
          * Grund: Log-Funktion fehlte in neuer index.html Version
        - PDF-EXPORT BUG BEHOBEN:
          * Problem: "malformed header from script: Bad header: %PDF-1.4"
          * Ursache: Konflikt zwischen print() (Text-Modus) und sys.stdout.buffer (Binary-Modus)
          * Lösung: send_response() Funktion in export-pdf.py komplett überarbeitet
          * Binäre PDF-Daten werden nun ausschließlich über sys.stdout.buffer geschrieben
          * HTTP-Header werden als bytes encoded vor den PDF-Daten geschrieben
          * Content-Length Header hinzugefügt für korrekte Browser-Verarbeitung
        - GRUND:
          * 404-Fehler bei allen CGI-Scripts behoben
          * PDF-Download funktioniert jetzt korrekt im Browser
          * Log-Anzeige wieder vollständig funktionsfähig

        33. [17.02.2026 09:00] - GITHUB RAW-URL CACHE VERHALTEN DOKUMENTIERT:
        - raw.githubusercontent.com URLs werden von GitHub bis zu 10 Minuten gecacht
        - Nach einem git push ist die neue Version NICHT sofort über Raw-URLs sichtbar
        - Dies betrifft alle GitHub-Accounts (Gratis und bezahlt)
        - Lösung: Nach git push einfach 5-10 Minuten warten
        - Die Dateien sind korrekt auf GitHub sobald git push erfolgreich war
        - Prüfung ob Upload korrekt war: git log --oneline und git show --name-only
        - Lokale Kontrolle: grep -c "schlüsselwort" /pfad/zur/datei

        34. [17.02.2026 10:00] - BUG-FIX deleteMessage() - Option A implementiert:
        - deleteMessage() löscht jetzt angeklickte Nachricht + ALLE nachfolgenden
        - Bestätigungsdialog: "Diese Nachricht und alle nachfolgenden Nachrichten löschen?"
        - DOM: Nachricht-Container + alle Geschwister-Elemente (inkl. Trennlinien) entfernt
        - contextHistory: messages.slice(0, msgIndex) - alles ab Position entfernt
        - Git: a591bce

        35. [17.02.2026 11:00] - TXT/RTF EXPORT + DL-BUTTON EINZELNACHRICHTEN:
        - Gesamt-Export Dropdown um 2 Formate erweitert: TXT und RTF
        - export-txt.py: neues CGI-Script fuer TXT-Export des gesamten Chats
        - export-rtf.py: neues CGI-Script fuer RTF-Export (ohne externe Library, Umlaute als RTF-Codes)
        - DL-Button [DL] gruen bei Hover neben X-Button fuer jede Nachricht
        - DL-Button oeffnet Dropdown: Als TXT / Als Markdown / Als RTF / Als PDF
        - TXT, Markdown, RTF Einzel-Export direkt im Browser (JavaScript Blob, kein Server)
        - PDF Einzel-Export ueber bestehendes export-pdf.py (nur eine Nachricht)
        - Git: 01e0fb3 (index.html) + da8282c (export-txt.py) + 5aa5213 (export-rtf.py) + 7d038c1 (files-directorys)


        36. [17.02.2026 17:00] - FEEDBACK-BUTTONS FUER AI-ANTWORTEN IMPLEMENTIERT:
        - 4 neue Buttons bei jeder AI-Antwort (erscheinen beim Hover, links unten)
        - [Copy] - Kopiert Nachrichtentext in die Zwischenablage, zeigt kurz "Copied!"
        - [Like] - Gruen markiert, schreibt LIKE-Eintrag in deepseek-chat.log
        - [Dislike] - Rot markiert, schreibt DISLIKE-Eintrag in deepseek-chat.log
        - [Regen] - Loescht alte AI-Antwort, generiert neue Antwort auf dieselbe User-Frage
        - Like/Dislike gegenseitig ausschliessend (Klick auf Like deaktiviert Dislike und umgekehrt)
        - Feedback-Buttons nur bei AI-Antworten, nicht bei User-Nachrichten
        - Neues CGI-Script feedback-log.py schreibt ins bestehende deepseek-chat.log
        - Log-Format: YYYY-MM-DD HH:MM:SS | IP | FEEDBACK | LIKE/DISLIKE | msgId | "Preview"
        - Git: a2e371b (index.html) + e3ba685 (feedback-log.py)

        37. [17.02.2026 18:30] - MAGIC BYTES PRUEFUNG GEGEN AUSFUEHRBARE DATEIEN:
        - Sicherheits-Feature: Erkennung ausfuehrbarer Dateien anhand Magic Bytes
        - Schuetzt vor umbenannten EXE/ELF/Mach-O Dateien (z.B. virus.exe -> virus.jpg)
        - Erkannte Plattformen:
          * Windows 32/64 Bit (PE/MZ Header - EXE, DLL, SYS)
          * Linux 32/64 Bit (ELF32/ELF64 Header)
          * macOS 32/64 Bit (Mach-O Little/Big Endian)
          * macOS Universal Binary (Fat Binary - mehrere Architekturen)
          * ARM 32 Bit (ELF32 ARM Little Endian)
          * ARM 64 Bit (ELF64 AArch64 Little Endian)
          * Shell Scripts (Shebang #! Header)
          * Python Bytecode (.pyc Dateien Python 3.8+)
        - Pruefung erfolgt VOR der Dateiverarbeitung durch Lesen der ersten 20 Bytes
        - Bei Treffer: Upload wird blockiert mit detaillierter Fehlermeldung
        - Standalone Python-Script detect-executable.py fuer Server-seitige Pruefung erstellt
        - Git: 301880c (index.html mit Magic Bytes Pruefung)


        38. [17.02.2026 23:30] - STREAMING RESPONSES IMPLEMENTIERT:
        - AI-Antworten erscheinen jetzt Token-fuer-Token (wie ChatGPT/Claude)
        - Server-Sent Events (SSE) statt blocking JSON response
        - deepseek-api.py: stream: True aktiviert, text/event-stream Header
        - index.html: sendMessage() komplett umgebaut fuer Streaming-Empfang
        - ReadableStream API mit TextDecoder fuer Token-Parsing
        - Auto-Scroll waehrend Streaming fuer bessere UX
        - Psychologischer Effekt: Antwort startet nach 0.3s statt 8s "Denkt..."
        - handleRegenerate() noch OHNE Streaming (TODO fuer naechste Version)
        - Git: aa4ecf7 (deepseek-api.py) + 0963081 (index.html mit Streaming)
        - Deutlich bessere User Experience bei langen Antworten

    ============================================================================

